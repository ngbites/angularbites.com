<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png"><link rel="icon" href="/assets/images/favicon.ico"><title>A simple Countdown with RxJS</title><meta name="description" content="In this tutorial, we’re going to build a very simple timer application with only a few lines of code using RxJS"><meta name="author" content="Giancarlo Buomprisco"><meta property="og:title" content="A simple Countdown with RxJS"><meta property="og:description" content="In this tutorial, we’re going to build a very simple timer application with only a few lines of code using RxJS"><meta property="og:locale" content="en"><meta property="og:site_name" content="Angular Bites"><meta property="og:type" content="article"><meta name="twitter:image" property="og:image" content="https://angularbites.comhttps://cdn-images-1.medium.com/max/1600/1*UqfNSA5wgWcEXphLsBXuUg.gif"><meta property="twitter:title" content="A simple Countdown with RxJS"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:creator" content="@gc_psk"><meta property="twitter:description" content="In this tutorial, we’re going to build a very simple timer application with only a few lines of code using RxJS"><meta property="og:url" content="https://angularbites.com/a-simple-countdown-with-rx-js/"><meta property="article:published_time" content="2019-06-05T00:00:00.000Z"><script type="application/ld+json">{
"description": "In this tutorial, we’re going to build a very simple timer application with only a few lines of code using RxJS",
"author": { "@type": "Person", "name": "Giancarlo Buomprisco" },
"@type": "BlogPosting",
"url": "https://angularbites.com/a-simple-countdown-with-rx-js/",
"publisher": {
"@type": "Organization",
"logo": {
"@type": "ImageObject",
"url": "https://angularbites.com/assets/images/logo.png"
},
"name": "Giancarlo Buomprisco"
},
"headline": "A simple Countdown with RxJS",
"datePublished": "2019-06-05T00:00:00.000Z",
"mainEntityOfPage": {
"@type": "WebPage",
"@id": "https://angularbites.com/a-simple-countdown-with-rx-js/"
},
"@context": "http://schema.org"
}</script><link href="/assets/styles/main.35fec6ed6a4453d3d2c4.css" rel="stylesheet"></head><body><div class="container mx-auto pt-8"><header><div class="ml-5"><h1 class="text-4xl my-0"><a class="font-bold site-name flex items-center justify-center" href="/"><img class="logo" alt="Logo" src="/assets/images/logo.png"> Angular Bites</a></h1></div></header><article class="post pt-4"><header class="mb-8"><h1>A simple Countdown with RxJS</h1><div class="block items-center md:flex justify-center"><div class="user-image flex items-center"><a target="_blank" href="https://twitter.com/@gc_psk" class="flex items-center"><img src="/assets/images/giancarlo.jpeg"> <span class="ml-2 text-gray-600 text-sm">@gc_psk</span> </a><span class="text-gray-600 text-400 ml-1">/ June 5, 2019</span></div><div class="mt-2 md:ml-5 md:mt-0"><a href="/tags/rxjs" class="tag-item text-xs">rxjs</a></div></div><div class="featured-image mb-8 mt-8 hidden md:block"><img src="https://cdn-images-1.medium.com/max/1600/1*UqfNSA5wgWcEXphLsBXuUg.gif"></div></header><section class="pb-3"><h4>In this tutorial, we’re going to build a very simple timer application with only a few lines of code using RxJS.</h4><h3>Preview</h3><p>Before we get started, you can view the result using the awesome Stackblitz. You can see a preview of the final result at <a href="https://medium.com/r/?url=https%3A%2F%2Frxjs-rajp6s.stackblitz.io">this link</a>.</p><p>The timer starts automatically when you land on the page, you can click on the time to stop it, and click again to restart the timer.</p><p>When the time ends, the user will be prompted to take a break! It’s a very simple example, so the timer won’t restart.</p><h3>Constants</h3><p>Let’s first define some of the constants we’re going to use:</p><ul><li>We define <code>K</code> as we’re going to use this a lot, as we will be dealing with milliseconds, so we assign <code>1000</code> as value</li><li>The interval is the amount of time that needs to elapse in order to update the timer. If we set it to <code>5000</code>, the timer would be updated every 5 seconds</li><li>We set the minutes we want our timer to be long and its time in milliseconds</li></ul><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token constant">K</span> <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">INTERVAL</span> <span class="token operator">=</span> <span class="token constant">K</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">MINUTES</span> <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">TIME</span> <span class="token operator">=</span> <span class="token constant">MINUTES</span> <span class="token operator">*</span> <span class="token constant">K</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">;</span></code></pre><h3>State variables</h3><p>In order to keep the time’s state when pausing/resuming the timer, we define two variables:</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">let</span> current<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> time <span class="token operator">=</span> <span class="token constant">TIME</span><span class="token punctuation">;</span></code></pre><ul><li><code>current</code> will be continually updated every second</li><li><code>time</code> will be updated when the timer stops</li></ul><h3>Helper functions</h3><p>We define some helper functions used by our streams. We want to:</p><ul><li>convert remaining time to milliseconds and seconds</li><li>have functions to display remaining minutes and seconds</li></ul><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token function-variable function">toMinutes</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ms<span class="token operator">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span><br>    Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>ms <span class="token operator">/</span> <span class="token constant">K</span> <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">toSeconds</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ms<span class="token operator">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span><br>    Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>ms <span class="token operator">/</span> <span class="token constant">K</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">60</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">toSecondsString</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ms<span class="token operator">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> seconds <span class="token operator">=</span> <span class="token function">toSeconds</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> seconds <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">0</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>seconds<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> seconds<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">toMs</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">t<span class="token operator">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> t <span class="token operator">*</span> <span class="token constant">INTERVAL</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">currentInterval</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> time <span class="token operator">/</span> <span class="token constant">INTERVAL</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">toRemainingSeconds</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">t<span class="token operator">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">currentInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> t<span class="token punctuation">;</span></code></pre><h3>Defining the Rx streams</h3><p>First, we define the <code>timer$</code> stream:</p><ul><li>we use the observable creator <code>timer</code>, that emits every <code>INTERVAL</code> times, which basically means it will emit every second</li></ul><p>The stream will convert the milliseconds emitted from <code>timer</code> to the remaining seconds.</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> toggle$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BehaviorSubject</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> remainingSeconds$ <span class="token operator">=</span> toggle$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><br>    <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">running<span class="token operator">:</span> <span class="token builtin">boolean</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> running <span class="token operator">?</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">INTERVAL</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token constant">NEVER</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token function">map</span><span class="token punctuation">(</span>toRemainingSeconds<span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token function">takeWhile</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=></span> t <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Let’s explain detail what this does:</p><pre><code>**toggle$** -&gt; true...false...true

-----

**switchMap** to:

 **if toggle is true -&gt; timer(0, INTERVAL = 1000)** -&gt; 0...1000...2000
 **if toggle is false ? -&gt;** NEVER = do not continue

----

**map(toRemainingSeconds)** -&gt; ms elapsed mapped to remaining seconds (ex. 1500)

----

**takeWhile(remainingSeconds)** -&gt; complete once **remainingSeconds$'s** value  is no more &gt;= 0
</code></pre><p>Let’s consider the operators used:</p><ul><li>the mapper <code>toSeconds</code> will convert the milliseconds returned by the observable to the number of seconds that are remaining</li><li>by using the operator <code>takeWhile</code> we’re basically telling the <code>remainingSeconds$</code> observable to keep going until the seconds remaining are greater or equal than 0</li><li>After that, <code>remainingSeconds$</code> will emit its completion callback that we can use to replace the timer with some other content</li></ul><p>Before creating the relative minutes and seconds we will be displaying, we want to be able to stop and resume and timer.</p><p>If <code>toggle$</code> is emitted with <code>true</code> as value, the timer keeps running, while if it gets emitted with <code>false</code> it will stop, as instead of mapping to <code>remainingSeconds$</code> it will emit the observable <code>NEVER</code> .</p><h3>Pausing and resuming the timer</h3><p>By using <code>fromEvent</code> , we can listen to click events and update the behavior subject by toggling its current value.</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> toggleElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.timer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token function">fromEvent</span><span class="token punctuation">(</span>toggleElement<span class="token punctuation">,</span> ‘click’<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    toggle$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token operator">!</span>toggle$<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>But <code>toggle$</code> also does something else:</p><ul><li>every time the timer gets stopped, we want to update the time variable with the current time, so that the next time the timer restarts, it will restart from the current time.</li></ul><pre class="language-typescript"><code class="language-typescript">toggle$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><br>    <span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">toggled<span class="token operator">:</span> <span class="token builtin">boolean</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">!</span>toggled<span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    time <span class="token operator">=</span> current<span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Now, we can define the milliseconds observable we’re going to use to display minutes and seconds:</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> ms$ <span class="token operator">=</span> time$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><br>    <span class="token function">map</span><span class="token punctuation">(</span>toMs<span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=></span> current <span class="token operator">=</span> t<span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Every time <code>ms$</code> emits, we use the <code>tap</code> operator to update the stateful variable <code>current</code>.</p><p>Next, we’re going to define minutes and seconds by reusing the helper methods we defined earlier in the article.</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> minutes$ <span class="token operator">=</span> ms$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><br>    <span class="token function">map</span><span class="token punctuation">(</span>toMinutesDisplay<span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">s</span> <span class="token operator">=></span> s<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token function">startWith</span><span class="token punctuation">(</span><span class="token function">toMinutesDisplay</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> seconds$ <span class="token operator">=</span> ms$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><br>    <span class="token function">map</span><span class="token punctuation">(</span>toSecondsDisplayString<span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token function">startWith</span><span class="token punctuation">(</span><span class="token function">toSecondsDisplayString</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>And that’s it! Our streams are ready and can now update the DOM.</p><h3>Updating the DOM</h3><p>We define a simple function called <code>updateDom</code> that takes an observable as the first argument and an HTML element as the second one. Every time the source emits, it will update the <code>innerHTML</code> of the node.</p><p>HTML:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>timer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>minutes<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>seconds<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// DOM nodes</span><br><span class="token keyword">const</span> minutesElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.minutes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> secondsElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.seconds'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token function">updateDom</span><span class="token punctuation">(</span>minutes$<span class="token punctuation">,</span> minutesElement<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">updateDom</span><span class="token punctuation">(</span>seconds$<span class="token punctuation">,</span> secondsElement<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">updateDom</span><span class="token punctuation">(</span><span class="token parameter">source$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">,</span> element<span class="token operator">:</span> Element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    source$<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> element<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Lastly, we want to display a message when the timer stops:</p><pre class="language-typescript"><code class="language-typescript">timer$<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token function-variable function">complete</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">updateDom</span><span class="token punctuation">(</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token string">'Take a break!'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> toggleElement<span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="https://cdn-images-1.medium.com/max/1600/1*viwakc1HIU6SKXtrXgTLPw.gif" alt=""></p><p>You can find the complete code snippet on <a href="https://medium.com/r/?url=https%3A%2F%2Fstackblitz.com%2Fedit%2Frxjs-rajp6s%3Ffile%3Dindex.ts">Stackblitz</a>.</p><p>Hope you enjoyed the article and leave a message if you agree, disagree, or if you would do anything differently!</p><hr><p><em>If you enjoyed this article, follow me on</em> <a href="https://medium.com/@.gc"><em>Medium</em></a> <em>or</em> <a href="https://medium.com/r/?url=https%3A%2F%2Ftwitter.com%2Fhome"><em>Twitter</em></a> <em>for more articles about Angular, RxJS, Typescript and more!</em></p></section><div><script async data-uid="3e3126f064" src="https://thoughtful-inventor-7842.ck.page/3e3126f064/index.js"></script></div><div class="text-sm mt-2">Do you want to report something incorrect? Please open an Issue or a PR on <a class="underline" href="https://github.com/Gbuomprisco/angularbites.com">Github</a></div><footer class="mt-5 pb-5 mb-10"><a class="underline" href="/">Back to home</a></footer></article></div><script async src="https://www.googletagmanager.com/gtag/js?id=UA-172483071-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-172483071-1")</script><script async data-uid="da0d688ec8" src="https://thoughtful-inventor-7842.ck.page/da0d688ec8/index.js"></script><link href="https://fonts.googleapis.com/css2?family=Martel:wght@400;700;800&display=swap" rel="stylesheet"></body></html>