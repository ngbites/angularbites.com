<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png"><link rel="icon" href="/assets/images/favicon.ico"><title>Building Scalable Multi-Platform Projects with Angular andÂ Nx</title><meta name="description" content="Articles, training and resources for Angular, Stencil, Firebase, Typescript, Nx"><meta name="author" content="Giancarlo Buomprisco"><meta property="og:title" content="Building Scalable Multi-Platform Projects with Angular andÂ Nx"><meta property="og:description" content="Articles, training and resources for Angular, Stencil, Firebase, Typescript, Nx"><meta property="og:locale" content="en"><meta property="og:site_name" content="Angular Bites"><meta property="og:type" content="article"><meta name="twitter:image" property="og:image" content="https://angularbites.comhttps://cdn-images-1.medium.com/max/1600/0*erZf_hQ4V3MLHSyf"><meta property="twitter:title" content="Building Scalable Multi-Platform Projects with Angular andÂ Nx"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:creator" content="@gc_psk"><meta property="twitter:description" content="Articles, training and resources for Angular, Stencil, Firebase, Typescript, Nx"><meta property="og:url" content="https://angularbites.com/building-scalable-multi-platform-projects-with-angular-and-nx/"><meta property="article:published_time" content="2019-08-25T00:00:00.000Z"><script type="application/ld+json">{
"description": "Articles, training and resources for Angular, Stencil, Firebase, Typescript, Nx",
"author": { "@type": "Person", "name": "Giancarlo Buomprisco" },
"@type": "BlogPosting",
"url": "https://angularbites.com/building-scalable-multi-platform-projects-with-angular-and-nx/",
"publisher": {
"@type": "Organization",
"logo": {
"@type": "ImageObject",
"url": "https://angularbites.com/assets/images/logo.png"
},
"name": "Giancarlo Buomprisco"
},
"headline": "Building Scalable Multi-Platform Projects with Angular andÂ Nx",
"datePublished": "2019-08-25T00:00:00.000Z",
"mainEntityOfPage": {
"@type": "WebPage",
"@id": "https://angularbites.com/building-scalable-multi-platform-projects-with-angular-and-nx/"
},
"@context": "http://schema.org"
}</script><link href="/assets/styles/main.b2696e969cfb4f822b8d.css" rel="stylesheet"></head><body><div class="container mx-auto pt-8"><header><div class="ml-5"><h1 class="text-4xl my-0"><a class="font-bold site-name flex items-center justify-center" href="/"><img class="logo" alt="Logo" src="/assets/images/logo.png"> Angular Bites</a></h1></div></header><article class="post pt-4"><header class="mb-6"><h1>Building Scalable Multi-Platform Projects with Angular andÂ Nx</h1><div class="mb-5 mt-5 hidden md:block"><img src="https://cdn-images-1.medium.com/max/1600/0*erZf_hQ4V3MLHSyf"></div><div class="block items-center md:flex"><div class="user-image flex items-center"><a target="_blank" href="https://twitter.com/@gc_psk" class="flex items-center"><img src="/assets/images/giancarlo.jpeg"> <span class="ml-2 text-gray-600 text-sm">@gc_psk</span> </a><span class="text-gray-600 text-400 ml-1">/ August 25, 2019</span></div><div class="mt-2 md:ml-5 md:mt-0"><a href="/tags/nx" class="tag-item text-xs">nx </a><a href="/tags/angular" class="tag-item text-xs">angular </a><a href="/tags/ionic" class="tag-item text-xs">ionic</a></div></div></header><section class="pb-3"><p>This article is a follow-up from my previous thought that I wrote on <a href="https://medium.com/r/?url=https%3A%2F%2Fitnext.io%2Fbuilding-an-enterprise-grade-angular-project-structure-f5be32533ba3%3Fsource%3D---------19------------------">building enterprise-scale projects in Angular</a>.</p><p>In the previous article, monorepos and Nx were mentioned but I had not yet had the pleasure to try them out. It was clear, that although the structure mentioned was decent enough for a single project targeting a single platform, it would have fallen short for sharing code with other projects.</p><h3>Monorepos to theÂ rescue</h3><p>In the past few months, I have been working on multiple projectsâ€Šâ€”â€Šsome with a high degree of complexity; one of my projects required me to <strong>write an application that needs to be able to run on multiple platforms</strong>, which is one of the reasons why I felt the previous article needed an update:</p><ul><li>I want to ship a single project for multiple devices (mobile, desktop) sharing as much code as possible</li><li>I want my projectâ€™s <em>API</em> to share models with the client applications, in the same workspace</li><li>I want <em>SSR</em> (Server-Side Rendering) because, well, itâ€™s 2019</li></ul><h3>What this article isÂ about</h3><p>Letâ€™s face it - Building scalable projects is hard. Iâ€™m sure you had a similar conversation at least once in your career:</p><ul><li><strong>You</strong>: Hey, where should we place these functions? Itâ€™s getting messy ğŸ¤”</li><li><strong>Colleague</strong>: Oh, just create (yet another) folder â€œutilsâ€ and put it there ğŸ˜</li><li><strong>You</strong>: Okayâ€¦ ğŸ™„</li></ul><p>In the first part of this article, <strong>weâ€™re going to discuss how Nx helps structure your applications</strong>, and how we can leverage it to build insanely scalable projects.</p><p>In the second part, we take a more hands-on approach: <strong>a step-by-step guide on setting up an Angular application</strong> that is server-side rendered with NestJS, sharing code with a mobile Ionic application. It took some time for me to get it all right, so I want to help you (and future me) to do it effortlessly.</p><h2>Tech Stack</h2><p>In order to do this, I will be using the following technologies:</p><ul><li><a href="https://medium.com/r/?url=https%3A%2F%2Fnx.dev%2Fangular"><strong>Nx Workspaces</strong></a>: without a doubt the best tool to manage monorepos with <em>Angular</em> projects. <em>Nx</em> augments the CLI and allows us to easily build multiple apps in the same repository with ease</li><li><strong>Ionic/xplat:</strong> Ionic is an awesome mobile framework for building cross-platform apps. Thanks to <a href="https://medium.com/r/?url=https%3A%2F%2Fnstudio.io%2Fxplat">xPlat</a>, we will be able to easily create an Ionic app that integrates with <em>Nx</em></li><li><a href="https://medium.com/r/?url=https%3A%2F%2Fnestjs.com%2F"><strong>NestJS</strong></a>: a progressive <em>NodeJS</em> framework inspired by <em>Angular</em></li></ul><h2>Introduction to Nx Workspaces</h2><p>There are two reasons why you may want to use <em>Nx</em>:</p><ul><li>you work with multiple teams and multiple projects that can share code together</li><li>or, you are obsessed with code organization like I am!</li></ul><p>Jokes aside, <em>Nx</em> is a wonderful tool that <strong>helps to organize code in a scalable fashion</strong>; even if youâ€™re not planning on writing the next Facebook, the goodies provided by the <a href="https://medium.com/r/?url=https%3A%2F%2Fnrwl.io">Nrwl</a> team are enough of a reason for me to kickstart my projects with <em>Nx</em>.</p><h3>Applications</h3><p>Nx is a tool to create extensible mono-repository projects. If you have used the Angular CLI, <em>Nx</em> will look familiar, but with some differences.</p><p>Every application will be created within a folder called <code>/apps</code>, including your e2e tests project. For example, you may create apps written in <em>Angular</em>, <em>React</em>, <em>Ionic</em>, <em>Nativescript</em>, <em>Express</em>, <em>NestJS</em>, etc.</p><p>Or, <strong>all of them at once</strong>, sharing code!</p><h3>Libraries</h3><p>Your libraries, instead, will be placed within the folder <code>/libs</code>.</p><p>What exactly are they, though? Of course, small reusable pieces of code than any application within our workspace can use; but as <em>Nx</em> also says, <strong>libraries are smaller units of code with a well-defined API</strong>.</p><p>Libraries are ideal for sharing <strong>Angular Entities</strong> and <strong>Typescript Entities.</strong> For example:</p><ul><li>It is likely that you will want to share the same interfaces between front-end and back-end. Creating a lib called <code>models</code> will allow all your applications to access the same models without having to rewrite them twice</li><li>Your applications will likely make use of lots of components, pipes, directives, and services that will be common between all your applications: tests, mobile, front-office, back-office, etc.</li></ul><h3>Anatomy of an Nx Workspace</h3><p>The project structure below is the starting point of any Nx project:</p><pre><code>&lt;workspace name&gt;/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ myapp/
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”‚   â”œâ”€â”€ environments/
â”‚   â”‚   â”‚   â”œâ”€â”€ favicon.ico
â”‚   â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â”‚   â”œâ”€â”€ main.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ polyfills.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ styles.scss
â”‚   â”‚   â”‚   â””â”€â”€ test.ts
â”‚   â”‚   â”œâ”€â”€ browserslist
â”‚   â”‚   â”œâ”€â”€ jest.config.js
â”‚   â”‚   â”œâ”€â”€ tsconfig.app.json
â”‚   â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”‚   â”œâ”€â”€ tsconfig.spec.json
â”‚   â”‚   â””â”€â”€ tslint.json
â”‚   â””â”€â”€ myapp-e2e/
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ fixtures/
â”‚       â”‚   â”‚   â””â”€â”€ example.json
â”‚       â”‚   â”œâ”€â”€ integration/
â”‚       â”‚   â”‚   â””â”€â”€ app.spec.ts
â”‚       â”‚   â”œâ”€â”€ plugins/
â”‚       â”‚   â”‚   â””â”€â”€ index.ts
â”‚       â”‚   â””â”€â”€ support/
â”‚       â”‚       â”œâ”€â”€ app.po.ts
â”‚       â”‚       â”œâ”€â”€ commands.ts
â”‚       â”‚       â””â”€â”€ index.ts
â”‚       â”œâ”€â”€ cypress.json
â”‚       â”œâ”€â”€ tsconfig.e2e.json
â”‚       â”œâ”€â”€ tsconfig.json
â”‚       â””â”€â”€ tslint.json
â”œâ”€â”€ libs/
â”œâ”€â”€ tools/
â”œâ”€â”€ README.md
â”œâ”€â”€ angular.json
â”œâ”€â”€ nx.json
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ tslint.json
</code></pre><h2>Working with Nx: Creating Applications</h2><p>Now that I (may have) convinced you to use <em>Nx</em> and <em>Angular</em>, I am going to show you, step-by-step, how to set up a dream tech-stack that I described above.</p><h3>Creating a new Nx Workspace with Angular andÂ Nest</h3><p>We will start with a few commands that will kickstart our project structure thanks to <em>Nx</em> until we will have a working monorepo project with the latest Angular version and <em>NestJS</em> as <em>NodeJs</em> framework.</p><p>The following command will generate a working monorepo project with the latest Angular version and NestJS as Server-Side Node framework:</p><p><img src="https://cdn-images-1.medium.com/max/2400/1*uhEP6aleLqbeyXYuptXvWg.png" alt=""></p><pre><code>$ new workspace --preset=&quot;angular-nest&quot; --appName=&quot;nx-angular-ssr&quot; --style=&quot;scss&quot; --collection=[@nrwl/workspace](https://medium.com/r/?url=http%3A%2F%2Ftwitter.com%2Fnrwl%2Fworkspace &quot;Twitter profile for @nrwl/workspace&quot;)
</code></pre><p>The command line will prompt what style preprocessor you like, Iâ€™d recommend choosing <em>SCSS</em>.Â  Sit tight, it will take a while. Nx will create a workspace in a folder named <code>workspace</code>.</p><h2>API and Server-Side Rendering</h2><p>NestJS provides an awesome CLI plugin in order to automatically prepare the application for server-side rendering.</p><p><img src="https://cdn-images-1.medium.com/max/1600/1*4A3J6f6vjWzOPYGtfijqKQ.png" alt=""></p><p>Run the following command in the Nx workspace:</p><pre><code>$ ng add @nestjs/ng-universal
</code></pre><p>When the command line prompts for the application name, enter <code>nx-angular-ssr</code>. The plugin will create a folder named <code>server</code>, but we already have a server application, so we will ignore that (that means, you can delete it). As expected, we need to do some changes.</p><h3>Importing Angularâ€™s Universal Module</h3><p>The first thing to do is to import Angular Universal in our Nest application: to do that, we open the file <code>apps/api/app/app.module.ts</code> and we paste the following code to the imports array of the <code>AppModule</code> class:</p><pre class="language-typescript"><code class="language-typescript">AngularUniversalModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  viewsPath<span class="token operator">:</span> <span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'dist/browser'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  bundle<span class="token operator">:</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'../server/main'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  liveReload<span class="token operator">:</span> <span class="token boolean">true</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>Of course, donâ€™t forget to import <code>AngularUniversalModule</code> and <code>join</code>.</p><h3>Fixing the environments` path</h3><p>We need to apply a small change to the <code>angular.json</code> configuration. Unfortunately, the path to the environments files is incorrect, so we patch it according to the real path, which is <code>apps/nx-angular-ssr/src/environments</code> as shown in the image below:</p><p><img src="https://cdn-images-1.medium.com/max/1600/1*BJqLeuogbRK5Er5qzy6Tug.png" alt=""></p><h3>Adjust Webpackâ€™s configuration</h3><p>The last thing we need to adjust is the serverâ€™s Webpack configuration. Open the file <code>webpack.server.config</code> and replace the content with the following snippet:</p><p>And at this point, itâ€™s all done! We only need to build and run our application.</p><h3>Run the Server-Rendered Angular app Wih NestÂ JS</h3><p>The NestJS plugin added some useful command to build and run the application. We first need to build the SSR application by running:</p><pre><code>$ npm run build:ssr
</code></pre><p>And then, weâ€™re able to serve it:</p><pre><code>$ npm run serve:ssr
</code></pre><p>Open your browser at <code>http://localhost:3333</code> and there is your server-rendered <em>Angular</em> application powered by <em>NestJS</em>!</p><h2>Adding an Ionic application withÂ xPlat</h2><p><a href="https://medium.com/r/?url=https%3A%2F%2Fnstudio.io%2Fxplat%2Fgetting-started%2Fgetting-started">xPlat</a> is a tool that extends Nx Workspaces with a set of generators that help kickstart projects written in <em>Electron</em>, <em>NativeScript</em>, and <em>Ionic</em>. In our case, we want to use it for generating a mobile application written using Ionic.</p><h3>Generating an IonicÂ app</h3><p>In order to generate applications using xPlat, we need to install it first. Run this CLI command in your workspace root:</p><pre><code>ng add @nstudio/xplat
</code></pre><p>You will be prompted what sort of application you want to use:</p><pre><code>[] Electron
[] NativeScript
[-] Ionic
</code></pre><p>In our case, we will choose Ionic for Angular projects (which will be asked in the next step).</p><p>We will then generate our application using the following command:</p><pre><code>$ ng generate app
</code></pre><p>The CLI will prompt us for some configuration. Here are my choices below:</p><p><img src="https://cdn-images-1.medium.com/max/1600/1*vUwvmpVe47N9wcoIV-ehAA.png" alt=""></p><p>When the CLI asks for the folder where the app will be located, enter an empty space, and it will be automatically placed within <code>apps</code>.</p><h3>Adding Capacitor</h3><p><em>Capacitor</em> is <em>Ionicâ€™s</em> framework to build cross-platform applications. For some reason, it did not automatically get added, so we install it manually:</p><pre><code>$ npm i --save-dev @capacitor/core
</code></pre><h3>Running theÂ app</h3><p>We will run the application in the same way we run any other CLI application. The only thing to notice is that <em>xPlat</em> prefixed the name of our application with the prefix <code>ionic-</code>.</p><p>Run the following command in order to run the Ionic app in the browser:</p><pre><code>$ ng serve ionic-mobile
</code></pre><p><img src="https://cdn-images-1.medium.com/max/1600/1*nrXO1F4fbIGGgTP_95RsEA.png" alt=""></p><h3>Sharing Code</h3><p>Now that the app is set-up and running, we want to start sharing code between our applications. An example of ideal code-sharing would be our state-management modules or a UI component library.</p><p>As we said earlier, all the code that we plan to share across the applications will be added as a library under the folder <code>libs</code>. The application generated by xPlat already sets up the paths for us to import libraries using virtual paths, but I wasnâ€™t too happy with it.</p><p>The default virtual path in the tsconfig.json is set-up as follows:</p><pre><code>&quot;@workspace/*&quot;: [&quot;../../libs/*&quot;]
</code></pre><p>Unfortunately, this makes us have to also write the whole path to the <code>src/lib/index.ts</code> barrel file, which is inconvenient. As a result, I decided to add the following paths in order to access the UI library more quickly:</p><pre><code>&quot;paths&quot;: {
    ...other paths,
    &quot;@workspace/ui&quot;: [&quot;../../libs/ui/src/index.ts&quot;],
    &quot;@workspace/ui/*&quot;: [&quot;../../libs/ui/src/*&quot;]
}
</code></pre><p>Once thatâ€™s done, I open the file <code>home.module.ts</code> in our mobile application and import the UI libraryâ€™s module:</p><pre><code>// other imports...
import { UiModule } from '@workspace/ui';

@NgModule({
  imports: [SharedModule, HomeRoutingModule, UiModule],
  declarations: [HomeComponent],
  schemas: [CUSTOM_ELEMENTS_SCHEMA]
})
export class HomeModule {}
</code></pre><p>Our home route in the Ionic application has now access to the components developed in parallel with the other platforms!</p><h3>Not justÂ Ionic</h3><p>As we said, <em>xPlat</em> also allows you to build for other platforms, such as <em>NativeScript</em> and <em>Electron</em> (and who know what else in the future!).</p><p>As a result, the code could be shared between even more applications.</p><h2>Final Words</h2><p>Building a large project, able to share code and scale across multiple teams is surely no easy feat.</p><p>Monorepo architectures allow us to work in parallel and easily share code, and Nx makes managing the monorepo a much easier job than it would be otherwise.</p><p>This article showed you an example of how we can achieve a dream tech-stack with awesome technologies such as <em>NestJS</em> and <em>Ionic</em>, accelerate processes, maximize code reusability and organize a scalable project structure thanks to <em>Nx.</em></p><h3>References and RelatedÂ Reading</h3><ul><li><a href="https://medium.com/r/?url=https%3A%2F%2Fnx.dev%2Fangular">Nx</a></li><li><a href="https://medium.com/r/?url=https%3A%2F%2Fnstudio.io%2Fxplat">XPlat</a></li><li><a href="https://medium.com/r/?url=https%3A%2F%2Fblog.nrwl.io%2Fmisconceptions-about-monorepos-monorepo-monolith-df1250d4b03c">Misconceptions about Monorepos: MonorepoÂ != Monolith</a> by Victor Savkin</li></ul><p>If you need any clarifications, or if you think something is unclear or wrong, do please leave a comment!</p></section><div><script async data-uid="3e3126f064" src="https://thoughtful-inventor-7842.ck.page/3e3126f064/index.js"></script></div><div class="text-sm mt-2">Do you want to report something incorrect? Please open an Issue or a PR on <a class="underline" href="https://github.com/Gbuomprisco/angularbites.com">Github</a></div><footer class="mt-5 pb-5 mb-10"><a class="underline" href="/">Back to home</a></footer></article></div><script async src="https://www.googletagmanager.com/gtag/js?id=UA-172483071-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-172483071-1")</script><script src="https://zedform-sdk.web.app/tracking-sdk.umd.js"></script><script src="https://zedform-sdk.web.app/sdk.umd.js" async data-formtoro></script><div data-formtoro-form="10844c24-0314-4c31-8272-9e00dafdd0ec"></div><link href="https://fonts.googleapis.com/css2?family=Martel:wght@400;700;800&display=swap" rel="stylesheet"></body></html>