<!doctype html><html lang="en"><head><meta http-equiv="refresh" content="0;url=https://giancarlobuomprisco.com/angular/how-to-organize-nx-modules-with-angular"><link rel="canonical" href="https://giancarlobuomprisco.com"><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png"><link rel="icon" href="/assets/images/favicon.ico"><title>Principles for creating libraries with Nx and Angular</title><meta name="description" content="Working with Nx may be confusing. This article explains how I create Nx libraries and the principles behind my motivations."><meta name="author" content="Giancarlo Buomprisco"><meta property="og:title" content="Principles for creating libraries with Nx and Angular"><meta property="og:description" content="Working with Nx may be confusing. This article explains how I create Nx libraries and the principles behind my motivations."><meta property="og:locale" content="en"><meta property="og:site_name" content="Angular Bites"><meta property="og:type" content="article"><meta name="twitter:image" property="og:image" content="https://angularbites.com/assets/images/posts/organize-nx-modules-ngrx.png"><meta property="twitter:title" content="Principles for creating libraries with Nx and Angular"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:creator" content="@gc_psk"><meta property="twitter:description" content="Working with Nx may be confusing. This article explains how I create Nx libraries and the principles behind my motivations."><meta property="og:url" content="https://angularbites.com/how-to-organize-nx-modules-with-angular/"><meta property="article:published_time" content="2021-02-07T00:00:00.000Z"><script type="application/ld+json">{
"description": "Working with Nx may be confusing. This article explains how I create Nx libraries and the principles behind my motivations.",
"author": { "@type": "Person", "name": "Giancarlo Buomprisco" },
"@type": "BlogPosting",
"url": "https://angularbites.com/how-to-organize-nx-modules-with-angular/",
"publisher": {
"@type": "Organization",
"logo": {
"@type": "ImageObject",
"url": "https://angularbites.com/assets/images/logo.png"
},
"name": "Giancarlo Buomprisco"
},
"headline": "Principles for creating libraries with Nx and Angular",
"datePublished": "2021-02-07T00:00:00.000Z",
"mainEntityOfPage": {
"@type": "WebPage",
"@id": "https://angularbites.com/how-to-organize-nx-modules-with-angular/"
},
"@context": "http://schema.org"
}</script><link href="/assets/styles/main.01b26601bd28e56788b1.css" rel="stylesheet"></head><body><div class="container mx-auto pt-8"><header class="flex items-center"><h1 class="text-4xl my-0"><a class="site-name flex items-center" href="/"><img class="logo" alt="Logo" src="/assets/images/logo.png"></a></h1><div class="flex justify-end flex-grow"><nav class="flex main-navigation"><a class="p-4" href="/contacts.html">Contacts</a></nav></div></header><article class="post pt-4"><header class="mb-8"><h1 class="post-title">Principles for creating libraries with Nx and Angular</h1><div class="block items-center md:flex justify-center"><div class="user-image flex items-center"><a target="_blank" href="https://twitter.com/@gc_psk" class="flex items-center"><img src="/assets/images/giancarlo.jpeg"> <span class="ml-2 text-gray-600 text-sm">@gc_psk</span> </a><span class="text-gray-600 text-400 ml-1">/ February 7, 2021</span></div><div class="mt-2 md:ml-5 md:mt-0"><a href="/tags/nx" class="tag-item text-xs">nx </a><a href="/tags/angular" class="tag-item text-xs">angular</a></div></div><div class="featured-image mb-8 mt-8 hidden md:block"><img src="/assets/images/posts/organize-nx-modules-ngrx.png"></div></header><section class="pb-3"><p>If you've worked with both Nx at least once, you probably know it's quite complex to figure out the best way to organize your code into modules a scalable way, and that makes sense.</p><p>When you're adding some additional code, have you ever thought about where to add it?</p><ul><li>An app?</li><li>A new module within an app?</li><li>The library where it's used?</li><li>Maybe a separate library?</li></ul><p>Yeah - I've been there too.</p><p>After lots of trial and error, I've settled on a way that seems clean, and that plays nicely with the Nx philosophy - but that can only work by following other principles.</p><p>This is still very much a work in progress and may change in the future, but in this article, I want to lay down some principles I follow (and intend to test further) when creating Nx libraries. I will try to dig deeper into each of these and describe them with clearer and more specific details.</p><h2>Why do we use Nx to separate code into libraries?</h2><p>This is the first point to consider: why are we using Nx to split our code into different libraries in the first place?</p><p>There are multiple reasons, but here are some that come to mind:</p><ul><li>I want to be able to reuse code across applications</li><li>I want each library to be a unit of the platform which is developed, changed and tested individually</li><li>I want to restrict the code my applications are allowed to know or use</li></ul><p>Nx also provides smart and efficient caching, which means we do not need to rebuild or re-test stuff that hasn't changed, but this is not of interest given this article's scope.</p><h3>Principle 1: Splitting by Responsibility</h3><p>I usually follow the Module type approach - but I apply it at the library-level. With the fact the Angular modules <em>may</em> go one day, I feel this is also the most future-proof way to think about it.</p><p>For example, I don't recommend writing your State Management and any UI components code within the same library. A State Management library is a Services Module and should not contain any declarations.</p><p>Indeed, the scope of the State Management library is to manipulate and handle the state of a particular slice of the store. By separating the two, we can build and test them independently and swap the implementations if necessary.</p><p>You will also want to access state from different parts of the application (or from multiple applications), and you don't want to bring needless declarations with you along the way.</p><p>Let's assume your company is an enterprise that makes software for writing Tasks (yet another!). What could your libraries look like?</p><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// state management</span>
<span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">TasksStateModule</span><span class="token punctuation">,</span> <span class="token maybe-class-name">TasksStateService</span> <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">'@enterprise/tasks/state'</span><span class="token punctuation">;</span>

<span class="token comment">// DTOs - these are very likely shared with your API!</span>
<span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">CreateTaskDto</span><span class="token punctuation">,</span> <span class="token maybe-class-name">DeleteTaskDto</span><span class="token punctuation">,</span> <span class="token maybe-class-name">UpdateTaskDto</span> <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">'@enterprise/tasks/dto'</span><span class="token punctuation">;</span>

<span class="token comment">// Domain</span>
<span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Task</span> <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">'@enterprise/tasks/domain'</span><span class="token punctuation">;</span>

<span class="token comment">// API</span>
<span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">TasksApiModule</span> <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">'@enterprise/tasks/api'</span><span class="token punctuation">;</span>

<span class="token comment">// common UI components and containers</span>
<span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">TasksUiModule</span> <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">'@enterprise/tasks/ui'</span><span class="token punctuation">;</span>

<span class="token comment">// Tasks Page / Routed Component</span>
<span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">TasksPageModule</span> <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">'@enterprise/tasks/page'</span><span class="token punctuation">;</span>

<span class="token comment">// routing (rarely needed, only use for overly complex configurations)</span>
<span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">TasksPageRoutingModule</span> <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">'@enterprise/tasks/routing'</span><span class="token punctuation">;</span>

<span class="token comment">// specific features of the domain, mostly UI components, services tha facilitate their work</span>
<span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">CreateTaskFeatureModule</span> <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">'@enterprise/tasks/features/create-task'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">DeleteTaskFeatureModule</span> <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">'@enterprise/tasks/features/delete-task'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">NewTaskFormFeatureModule</span> <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">'@enterprise/tasks/features/new-task-form'</span><span class="token punctuation">;</span></code></pre><p>The above should give you a good idea of this approach to a decently sized enterprise application.</p><p>You may want to initialize and handle state related to &quot;tasks&quot; even outside the &quot;Tasks page&quot;. This is why it's useful to separate the business domain from the UI components.</p><p>If you're wondering how to create sub-libraries, you can use the &quot;directory&quot; parameter when creating a library:</p><pre><code class="language-">nx generate library ui --directory tasks</code></pre><h3>Principle 2: libraries should limit the number of exported entities</h3><p>For example, in the case of a state library, only export state-related entities. That is <em>mostly actions and selectors</em>, or a Facade service that hides actions and events from the consumer if you're using one.</p><p>If you're finding yourself exporting any other entity, such as a client service, an interface (that is not the state), they can likely be placed in another common library, because chances are, these may be used elsewhere.</p><p>This suggests your library <em>may</em> be containing more than it should.</p><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// index.ts</span>

<span class="token keyword">export</span> <span class="token exports"><span class="token punctuation">{</span> <span class="token maybe-class-name">TasksStateModule</span> <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">'./tasks-state.module'</span><span class="token punctuation">;</span>

<span class="token comment">// consumers can interact and retrieve the state using the Facade</span>
<span class="token keyword">export</span> <span class="token exports"><span class="token punctuation">{</span> <span class="token maybe-class-name">TasksFacadeService</span> <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">'./services/tasks-facade.service'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token exports"><span class="token punctuation">{</span> <span class="token maybe-class-name">MockTasksFacadeService</span> <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">'./services/mock-tasks-facade.service'</span><span class="token punctuation">;</span></code></pre><h3>Principle 3: Libraries should change for one reason and one only</h3><p>We can apply the Single Responsibility Principle to Nx libraries: if a library changes for multiple reasons, then it could (should?) be split.</p><p>This is nothing new, and it's well-described in <em>Clean Architecture</em> by Uncle Bob. With that said - it's also really hard to do well in practical terms.</p><p>What exactly is a single &quot;reason&quot;? This is a pretty tricky question you should answer when architecting a library.</p><p>What does your library do?</p><ul><li>Does it define the logic of a particular domain of your application(s)?</li><li>Does it define a set of reusable UI components?</li><li>Does it define a set of specific components related to the business domain?</li></ul><p>If there is an &quot;and&quot; somewhere in your answer, then it's an indicator that you should separate the functionalities into another library.</p><h3>Final Words</h3><p>Nx is relatively new, and while I've seen many projects which approached it pretty well, I still have not seen one that I was entirely satisfied with.</p><p>I have personally made loads of mistakes with it - it's really not as easy as it seems to lay down a perfect architecture for complex applications.</p><p>As this is still something I'm trying to completely figure out, I cannot 100% recommend you follow it. If you enjoyed it, please do shoot me an email and let me know what you think of it.</p><hr><p><em>If you enjoyed this article, follow me on <a href="https://twitter.com/gc_psk">Twitter</a></em></p></section><div><script async data-uid="3e3126f064" src="https://thoughtful-inventor-7842.ck.page/3e3126f064/index.js"></script></div><div class="text-sm mt-2">Do you want to report something incorrect? Please open an Issue or a PR on <a class="underline" href="https://github.com/Gbuomprisco/angularbites.com">Github</a></div><footer class="mt-5 pb-5 mb-10"><a class="underline" href="/">Back to home</a></footer></article></div><script async data-uid="da0d688ec8" src="https://thoughtful-inventor-7842.ck.page/da0d688ec8/index.js"></script><link href="https://fonts.googleapis.com/css2?family=Martel:wght@400;700;800&display=swap" rel="stylesheet"></body></html>